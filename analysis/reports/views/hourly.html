<div class="hourly">
  <div class="row" ng-show="success">
    <div class="col-xs-4">
      <p class="text-muted">
        <strong>Initiative: </strong> {{params.init.title}} <br>
        <strong>Dates: </strong> {{params.sdate}} - {{params.edate}} <br>
        <strong>Subset: </strong> {{params.stime || '00:00'}} - {{params.etime || '23:59'}} <br>
        <strong>Days: </strong> {{params.daygroup.title}}
        <strong>Locations: </strong> {{params.location.title}}
        <strong>Activities: </strong> {{params.activity.title}}
      </p>
    </div>

    <div class="col-xs-8">
      <div class="row">
        <buttons-radio class="btn-group col-xs-5 pull-right" model="data.data" options="data.options"></buttons-radio>
        <div class="pull-right">
          <csv-hourly data="data"></csv-hourly>
          <chart-download chart="#chart-1" text="Save Line Chart" title="suma_hourly_line_chart.png"></chart-download>
          <chart-download chart="#chart-2" text="Save Calendar Chart" title="suma_hourly_calendar_chart.png"></chart-download>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12 chart-wrapper">
      <div class="loading" ng-show="loading"><img src="images/spinner.gif"></div>
      <div class="alert alert-info alert-block" ng-show="initial">
        <h4>Welcome!</h4>
        Please select an initiative from the select menu below. Once you have chosen an initiative, additional filter options will appear. You can also limit your search by date or time.
      </div>

      <div class="alert alert-danger alert-block" ng-show="error">
        <h4>Notice!</h4>
        <p>There was a problem retrieving data from the server. Please try again or contact your system administrator.</p>
        <p>Error Code: {{errorCode}}</p>
        <p>Error Message: {{errorMessage}}</p>
      </div>
      <hourly-line-chart id="chart-1" data="data.data" ng-show="success"></hourly-line-chart>
      <hourly-calendar-chart id="chart-2" data="data.data" stats="stats" ng-show="success"></hourly-calendar-chart>
    </div>
  </div>

  <div class="row" ng-hide="finder.active()">
    <div class="col-xs-3">
      <h3>Modify Chart</h3>
    </div>

    <div class="col-xs-3" ng-show="params.init && !processMetadata">
      <h3>Initiative Filters</h3>
    </div>

    <div class="col-xs-6" ng-show="success">
      <h3>Summary Statistics</h3>
    </div>
  </div>

  <div class="row">
    <div class="loading" ng-show="finder.active()"><img src="images/spinner.gif"></div>
  </div>

  <div class="row filter-row" ng-hide="finder.active()">
    <form ng-submit="submit()">
      <fieldset ng-disabled="loading">
        <div class="col-xs-3">
          <div class="form-group">
            <label for="initiatives" class="suma-popover" data-title="Select Initiative" data-content="Select an initiative to reveal additional filters." popover="">Select an Initiative</label>
            <select name="initiative" ng-model="params.init" ng-options="init.title for init in inits" ng-change="updateMetadata()" class="form-control">
              <option value="">Select an Initiative</option>
            </select>
          </div>

          <div class="form-group">
            <label for="sdate" class="suma-popover" data-title="Choose Date Range" data-content="Select a start date for your analysis. Defaults to 6 months from current day. Clear fields to retrieve the complete data set." popover="">Start Date</label>
            <datepicker model="params.sdate"></datepicker>
            <span class="help-block">YYYY-MM-DD</span>
          </div>

          <div class="form-group">
            <label for="edate" class="suma-popover" data-title="Choose Date Range" data-content="Select an end date for your analysis. Clear fields to retrieve complete data set." popover="">End Date</label>
            <datepicker model="params.edate"></datepicker>
            <span class="help-block">YYYY-MM-DD</span>
          </div>
        </div>

        <div class="col-xs-3 supp-wrapper" ng-show="processMetadata">
          <div class="loading"><img src="images/spinner.gif"></div>
        </div>

        <div class="col-xs-3" ng-show="params.init && !processMetadata">
          <div class="form-group">
            <label for="daygroup" class="suma-popover" data-title="Limit Days of the Week" data-content="Filter by Weekday or Weekend." popover="">Limit Days of the Week</label>
            <div class="controls">
              <select name="daygroup" id="daygroup" class="form-control" ng-model="params.daygroup" ng-options="day.title for day in dayOptions"></select>
            </div>
          </div>

          <div class="form-group">
            <label for="locations" class="suma-popover" data-title="Limit Locations" data-content="Select which locations to include in your analysis. Selecting a location with children will include all children in the data set." popover="">Limit Locations</label>
            <div class="controls">
              <select name="locations" ng-model="params.location" ng-options="loc | depth for loc in locations" class="form-control">
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="activities" class="suma-popover" data-title="Limit Activities" data-content="Select which activities to include in your analysis. Selecting an Activity Group will include all group activities." popover="">Limit Activities</label>
            <div class="controls">
              <select name="activities" ng-model="params.activity" ng-options="act | depth for act in activities" class="form-control">
              </select>
            </div>
          </div>

          <div>
            <input type="submit" id="submit" class="btn btn-success" value="{{loading ? 'Loading...' : 'Submit'}}">
          </div>
        </div>

        <div class="col-xs-6" ng-show="success">
          <table class="table table-hover table-condensed">
            <tbody>
              <tr>
                <td>Quartiles</td>
                <td>{{stats.quartiles}}</td>
              </tr>
              <tr>
                <td>Interquartile Range</td>
                <td>{{stats.iqr}}</td>
              </tr>
              <tr>
                <td>Lower Outlier Threshold</td>
                <td>{{stats.lowerOutlier}}</td>
              </tr>
              <tr>
                <td>Upper Outlier Threshold</td>
                <td>{{stats.upperOutlier}}</td>
              </tr>
              <tr>
                <td>Median</td>
                <td>{{stats.median}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </fieldset>
    </form>
  </div>
</div>