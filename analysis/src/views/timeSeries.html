<div class="time-series">
  <div class="row" ng-show="success">
    <div class="col-xs-5">
      <p class="text-muted">
        <strong>Initiative: </strong> {{params.init.title}} <br/>
        <strong>Classify By: </strong> {{params.count.title}}
        <strong>Whole Session: </strong> {{params.session_filter.title}} <br/>
        <strong>Dates: </strong> {{params.sdate}} - {{params.edate}}
        <strong>Subset: </strong> {{params.stime || '00:00'}} - {{params.etime || '23:59'}} <br/>
        <strong>Days: </strong> {{params.daygroup.title}}
        <strong>Locations: </strong> {{params.location.title}}
        <strong>Activities: </strong> {{params.activity.title}}
      </p>
    </div>
    <div class="col-xs-7">
      <div class="row">
        <suma-buttons-radio class="btn-group col-xs-4 pull-right" model="data.timeSeriesData" options="data.timeSeriesOptions"></suma-buttons-radio>
        <div class="pull-right">
          <a class="btn btn-default btn-sm" ng-click="scrollTo('export-data')">Export Raw Data</a>
          <a class="btn btn-default btn-sm" ng-click="scrollTo('summary-data')">Summary Data</a>
          <suma-chart-download chart="#chart-1" title="suma_timeseries_chart.png" filter=".sub-graph"></suma-chart-download>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12 time-series-chart-wrapper">
      <div class="loading" ng-show="loading"><img src="images/spinner.gif"></div>
      <div class="alert alert-info alert-block" ng-show="initial">
        <h4>Welcome!</h4>
        Please select an initiative from the select menu below. Once you have chosen an initiative, additional filter options will appear. You can also limit your search by date or time.
      </div>
      <div class="alert alert-danger alert-block" ng-show="error">
        <h4>Notice!</h4>
        <p>There was a problem retrieving data from the server. Please try again or contact your system administrator.</p>
        <p>Error Code: {{errorCode}}</p>
        <p>Error Message: {{errorMessage}}</p>
      </div>
      <suma-time-series-chart id="chart-1" data="data.timeSeriesData" ng-show="success"></suma-time-series-chart>
    </div>
  </div>

  <div class="row" ng-hide="finder.active()">
    <div class="col-xs-9">
      <h3>Modify Chart</h3>
    </div>

    <div class="col-xs-3" ng-show="params.init && !processMetadata">
      <h3>Initiative Filters</h3>
    </div>
  </div>

  <div class="row">
    <div class="loading" ng-show="finder.active()"><img src="images/spinner.gif"></div>
  </div>

  <div class="row filter-row" ng-hide="finder.active()">
    <form ng-submit="submit()">
      <fieldset ng-disabled="loading">
        <div class="col-xs-3">
          <div class="form-group">
            <label for="initiatives" class="suma-popover" data-title="Select Initiative" data-content="Select an initiative to reveal additional filters." suma-popover>Select an Initiative</label>
            <select name="initiative" ng-model="params.init" ng-options="init.title for init in inits" ng-change="updateMetadata()" class="form-control">
              <option value="">Select an Initiative</option>
            </select>
          </div>

          <div class="form-group">
            <label for="session" class="suma-popover" data-title="Classify Counts By" data-content='Choose the date to use for grouping counts by date. "Count Date" shows the actual date of the count, while "Session Start" and "Session End" use the respective date on the collection session containing each count.' suma-popover>Classify Counts By</label>
            <select name="session" id="session" class="form-control" ng-model="params.count" ng-options="count.title for count in countOptions">
            </select>
          </div>

          <div class="form-group">
            <label for="session_filter" class="suma-popover" data-title="Always Include Whole Session" data-content="Select yes if you would like to include counts inside of sessions that may fall outside of your other filters." suma-popover>Always Include Whole Session</label>
            <select name="session_filter" id="session_filter" class="form-control" ng-model="params.session_filter" ng-options="opt.title for opt in sessionOptions">
            </select>
          </div>
        </div>

        <div class="col-xs-3">
          <div class="form-group">
            <label for="sdate" class="suma-popover" data-title="Choose Date Range" data-content="Select a start date for your analysis. Defaults to 6 months from current day. Clear fields to retrieve the complete data set." suma-popover>Start Date</label>
            <suma-datepicker model="params.sdate"></suma-datepicker>
            <span class="help-block">YYYY-MM-DD</span>
          </div>

          <div class="form-group">
            <label for="edate" class="suma-popover" data-title="Choose Date Range" data-content="Select an end date for your analysis. Clear fields to retrieve complete data set." suma-popover>End Date</label>
            <suma-datepicker model="params.edate"></suma-datepicker>
            <span class="help-block">YYYY-MM-DD</span>
          </div>
        </div>

        <div class="col-xs-3">
          <div class="form-group">
            <label for="stime" class="suma-popover" data-title="Select Subset of Day" data-content="Include only data gathered during a certain time of day in your analysis, e.g. 20:00-22:00." suma-popover>Start Time</label>
            <suma-timepicker model="params.stime" placeholder="00:00"></suma-timepicker>
            <span class="help-block">24-hour format, e.g. 08:00</span>
          </div>

          <div class="form-group">
            <label for="etime" class="suma-popover" data-title="Select Subset of Day" data-content="Include only data gathered during a certain time of day in your analysis, e.g. 20:00-22:00." suma-popover>End Time</label>
            <suma-timepicker model="params.etime" placeholder="23:59"></suma-timepicker>
            <span class="help-block">24-hour format, e.g. 08:00</span>
          </div>
        </div>

        <div class="col-xs-3 supp-wrapper" ng-show="processMetadata">
          <div class="loading" ><img src="images/spinner.gif"></div>
        </div>

        <div class="col-xs-3" ng-show="params.init && !processMetadata">
          <div class="form-group">
            <label for="daygroup" class="suma-popover" data-title="Limit Days of the Week" data-content="Filter by Weekday or Weekend." suma-popover>Limit Days of the Week</label>
            <div class="controls">
              <select name="daygroup" id="daygroup" class="form-control" ng-model="params.daygroup" ng-options="day.title for day in dayOptions"></select>
            </div>
          </div>

          <div class="form-group">
            <label for="locations" class="suma-popover" data-title="Limit Locations" data-content="Select which locations to include in your analysis. Selecting a location with children will include all children in the data set." suma-popover>Limit Locations</label>
            <div class="controls">
              <select name="locations" ng-model="params.location" ng-options="loc | depth for loc in locations" class="form-control">
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="activities" class="suma-popover" data-title="Limit Activities" data-content="Select which activities to include in your analysis. Selecting an Activity Group will include all group activities." suma-popover>Limit Activities</label>
            <div class="controls">
              <select name="activities" ng-model="params.activity" ng-options="act | depth for act in activities" class="form-control">
              </select>
            </div>
          </div>

          <div>
            <input type="submit" id="submit" class="btn btn-success" value="{{loading ? 'Loading...' : 'Submit'}}" />
          </div>
        </div>
      </fieldset>
    </form>
  </div>

  <div id="summary-data" class="row">
    <div class="col-xs-5" ng-show="success" >
      <h3>Summary Data</h3>
      <div>
        <h4>Total Sum</h4>
        <p>{{data.total[0].count | countFormat}}</p>
      </div>
      <div>
        <h4>Totals by Location</h4>
        <table class="table table-hover table-condensed">
          <thead>
            <tr>
              <th>Location</th>
              <th>Total</th>
              <th>Percentage</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="loc in data.locationsTable" >
              <td>{{loc | depth}}</td>
              <td>{{loc.count | countFormat}}</td>
              <td>{{loc.percent}}%</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div>
        <h4>Totals by Activity</h4>
        <table class="table table-hover table-condensed">
          <thead>
            <tr>
              <th>Activity</th>
              <th>Total</th>
              <th>Percentage</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="act in data.activitiesTable">
              <td>{{act | depth}}</td>
              <td>{{act.count | countFormat}}</td>
              <td>{{act.percent}}%</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div>
        <h4>Totals by Year</h4>
        <table class="table table-hover table-condensed">
          <thead>
            <tr>
              <th>Year</th>
              <th>Total</th>
              <th>Percentage</th>
            </tr>
          </thead>
          <tbody>

            <tr ng-repeat="year in data.yearSummary">
              <td>{{year.name}}</td>
              <td>{{year.count | countFormat}}</td>
              <td>{{year.percent}}%</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div>
        <h4>Totals by Month</h4>
        <table class="table table-hover table-condensed">
          <thead>
            <tr>
              <th>Month</th>
              <th>Total</th>
              <th>Percentage</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="month in data.monthSummary">
              <td>{{month.name}}</td>
              <td>{{month.count | countFormat}}</td>
              <td>{{month.percent}}%</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div>
        <h4>Totals by Weekday</h4>
        <table class="table table-hover table-condensed">
          <thead>
            <tr>
              <th>Weekday</th>
              <th>Total</th>
              <th>Percentage</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="weekday in data.dayOfWeekSummary">
              <td>{{weekday.name}}</td>
              <td>{{weekday.count | countFormat}}</td>
              <td>{{weekday.percent}}%</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div>
        <h4>Totals by Hour</h4>
        <table class="table table-hover table-condensed">
          <thead>
            <tr>
              <th>Hour</th>
              <th>Total</th>
              <th>Percentage</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="hour in data.hourlySummary">
              <td>{{hour.name | hourFormat}}</td>
              <td>{{hour.count | countFormat}}</td>
              <td>{{hour.percent}}%</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="col-xs-7" ng-show="success">
      <div class="col-xs-12">
        <h3>Locations and Activities</h3>
      </div>
      <div class="col-xs-12">
        <suma-buttons-radio class="btn-group" data-toggle="buttons" model="data.actsLocsData" options="data.actsLocsOptions"></suma-buttons-radio>
        <suma-buttons-radio class="btn-group" data-toggle="buttons" model="data.barChartData" options="data.actsLocsData.items"></suma-buttons-radio>
        <suma-chart-download chart="#chart-2" title="suma_bar_chart.png"></suma-chart-download>

      </div>
      <div class="col-xs-12 bar-chart-wrapper">
        <suma-bar-chart id="chart-2" data="data.barChartData"></suma-bar-chart>
      </div>
      <div id="export-data" class="col-xs-12">
        <h3>Export Raw Data</h3>
        <suma-csv data="data"></suma-csv>
      </div>
    </div>
  </div>
</div>
