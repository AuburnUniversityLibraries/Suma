(function(t){function i(i){for(var n,o,c=i[0],r=i[1],u=i[2],d=0,h=[];d<c.length;d++)o=c[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&h.push(a[o][0]),a[o]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);l&&l(i);while(h.length)h.shift()();return s.push.apply(s,u||[]),e()}function e(){for(var t,i=0;i<s.length;i++){for(var e=s[i],n=!0,c=1;c<e.length;c++){var r=e[c];0!==a[r]&&(n=!1)}n&&(s.splice(i--,1),t=o(o.s=e[0]))}return t}var n={},a={app:0},s=[];function o(i){if(n[i])return n[i].exports;var e=n[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=t,o.c=n,o.d=function(t,i,e){o.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,i){if(1&i&&(t=o(t)),8&i)return t;if(4&i&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)o.d(e,n,function(i){return t[i]}.bind(null,n));return e},o.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(i,"a",i),i},o.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},o.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],r=c.push.bind(c);c.push=i,c=c.slice();for(var u=0;u<c.length;u++)i(c[u]);var l=r;s.push([0,"chunk-vendors"]),e()})({0:function(t,i,e){t.exports=e("56d7")},"034f":function(t,i,e){"use strict";var n=e("85ec"),a=e.n(n);a.a},"558e":function(t,i,e){},"56d7":function(t,i,e){"use strict";e.r(i);e("e260"),e("e6cf"),e("cca6"),e("a79d");var n=e("2b0e"),a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{attrs:{id:"app"}},[e("SumaClient")],1)},s=[],o=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"header_content"},[e("button",{staticClass:"headerbuttons leftalign menubutton",attrs:{"aria-label":"toggle menu"},on:{click:function(i){t.menuShown=!t.menuShown}}},[t.menuShown?e("i",{staticClass:"fas fa-times"}):e("i",{staticClass:"fas fa-bars"})]),e("button",{staticClass:"headerbuttons leftalign",attrs:{"aria-label":"Abandon all counts"},on:{click:function(i){return t.resetCounts()}}},[e("span",{staticClass:"buttontext"},[t._v("Abandon All Counts")]),e("i",{staticClass:"fas fa-trash-alt toolbar-icons"})]),e("button",{staticClass:"headerbuttons leftalign",attrs:{"aria-label":"Undo last count"},on:{click:function(i){return t.undoLastCount()}}},[e("span",{staticClass:"buttontext"},[t._v("Undo Last Count")]),e("i",{staticClass:"fas fa-undo toolbar-icons"})]),t.debug?e("button",{staticClass:"headerbuttons rightalign",on:{click:t.toggleDebugWindow}},[t._v("show debug")]):t._e(),e("button",{staticClass:"headerbuttons rightalign",attrs:{"aria-label":"finish collecting"},on:{click:function(i){return t.submitCounts()}}},[e("span",{staticClass:"buttontext"},[t._v("Finish collecting")]),e("i",{staticClass:"fas fa-check-circle toolbar-icons"})])]),e("transition",{attrs:{name:"sidebar"}},[t.menuShown?e("div",{staticClass:"selectbuttons"},[e("div",{staticClass:"alldropdowns"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.currentinit,expression:"currentinit"}],attrs:{"aria-label":"initiative dropdown",id:"initiativeDropdown"},on:{change:[function(i){var e=Array.prototype.filter.call(i.target.options,(function(t){return t.selected})).map((function(t){var i="_value"in t?t._value:t.value;return i}));t.currentinit=i.target.multiple?e:e[0]},function(i){return t.updateInit()}]}},[e("option",{attrs:{disabled:"",value:""}},[t._v("Select an initiative")]),t._l(t.initresults,(function(i){return e("option",{key:i.initiativeId,domProps:{value:i.initiativeId,innerHTML:t._s(i.initiativeTitle)}})}))],2),t._l(t.children,(function(i,n){return e("span",{key:n,attrs:{id:"locationtree-"+n}},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.childinit[n],expression:"childinit[index]"}],attrs:{"aria-label":"tree element dropdown"},on:{change:[function(i){var e=Array.prototype.filter.call(i.target.options,(function(t){return t.selected})).map((function(t){var i="_value"in t?t._value:t.value;return i}));t.$set(t.childinit,n,i.target.multiple?e:e[0])},function(i){return t.updateChild(n)}]}},[e("option",{attrs:{disabled:""},domProps:{value:void 0}},[t._v("Please select one")]),t._l(i,(function(i){return e("option",{key:i.id,domProps:{value:i.id}},[e("span",{domProps:{innerHTML:t._s(i.title)}}),i.children?t._e():e("span",[t._v(t._s(t.getCounts(i.id)))])])}))],2)])}))],2)]):t._e()]),t.showcounts?e("div",{class:[t.menuShown?"counts":"fullpagecounts"]},[e("h3",{attrs:{id:"current_loc_label"},domProps:{innerHTML:t._s(this.locationtitle)}}),e("form",{on:{submit:function(i){return i.preventDefault(),t.addToCount(1)}}},[Object.keys(t.activities).length>0?e("div",{staticClass:"activities"},t._l(t.activities,(function(i,n){return e("div",{key:n,staticClass:"activityGroup",class:{required:i.required}},[e("h3",{staticClass:"activityTitle"},[e("span",{domProps:{innerHTML:t._s(i.title)}}),i.required?e("span",{staticClass:"requiredicon"},[t._v("*")]):t._e(),i.allowMulti?e("span",{staticClass:"instructions"},[t._v(" (Choose one or more)")]):e("span",{staticClass:"instructions"},[t._v(" (Select one)")])]),t._l(i.options,(function(a){return e("div",{key:a.id,attrs:{id:"activityButton"}},[e("label",[i.allowMulti?e("input",{directives:[{name:"model",rawName:"v-model",value:t.activityvaluesmulti,expression:"activityvaluesmulti"}],staticClass:"button",attrs:{type:"checkbox",name:i.id,id:a.id},domProps:{value:a.id,checked:Array.isArray(t.activityvaluesmulti)?t._i(t.activityvaluesmulti,a.id)>-1:t.activityvaluesmulti},on:{click:function(i){return t.requiredFieldsCheck()},change:function(i){var e=t.activityvaluesmulti,n=i.target,s=!!n.checked;if(Array.isArray(e)){var o=a.id,c=t._i(e,o);n.checked?c<0&&(t.activityvaluesmulti=e.concat([o])):c>-1&&(t.activityvaluesmulti=e.slice(0,c).concat(e.slice(c+1)))}else t.activityvaluesmulti=s}}}):i.allowMulti?t._e():e("input",{directives:[{name:"model",rawName:"v-model",value:t.activityvalues[n],expression:"activityvalues[key]"}],attrs:{type:"radio",name:i.id,id:a.id},domProps:{value:a.id,checked:t._q(t.activityvalues[n],a.id)},on:{click:function(i){return t.deselect(a.id,n)},change:function(i){return t.$set(t.activityvalues,n,a.id)}}}),e("span",{domProps:{innerHTML:t._s(a.title)}})])])}))],2)})),0):t._e(),e("button",{staticClass:"countButton",attrs:{type:"submit",disabled:!t.buttonClickable,enabled:t.buttonClickable}},[t._v("Count"+t._s(t.getCounts(t.location)))])])]):e("div",[t._v(" No current location ")]),t.debug?e("div",{staticClass:"debug",staticStyle:{position:"fixed",bottom:"0","margin-left":"25%"},attrs:{id:"debugger",hidden:""}},[e("p",[t._v("If we finish now, this is sent to the sumaserver:")]),e("p",[t._v(t._s(t.syncCountDict))])]):t._e()],1)},c=[],r=(e("99af"),e("4de4"),e("a630"),e("c975"),e("d81d"),e("13d5"),e("a434"),e("b0c0"),e("b64b"),e("07ac"),e("3ca3"),e("bc3a")),u=e.n(r),l=e("a002"),d=e.n(l),h=e("096e"),v=e.n(h),f=e("1940"),p=e.n(f),m=e("761a"),b=e.n(m),y=e("2ef0"),g={name:"SumaClient",data:function(){return{initresults:"",currentinit:"",initdata:"",cachedinitdata:{},initurl:initiativeUrl,baseiniturl:baseInitUrl,syncurl:syncUrl,appVersion:"1.1.0",device:"",children:[],activities:{},childinit:{},counts:{},location:"",activityvalues:{},activityvaluesmulti:[],showcounts:!1,locationtitle:"",buttonClickable:!1,menuShown:!0,debug:!1}},created:function(){this.getDeviceData(),this.loadCounts(),this.loadInitInfo(),this.loadInitData()},updated:function(){},watch:{cachedinitdata:function(t){d.a.setItem("cachedinitdata",t)},counts:{handler:function(){d.a.setItem("counts",this.counts)},deep:!0},children:{handler:function(){this.showcounts&&this.addToCount(0)},deep:!0}},methods:{toggleDebugWindow:function(){var t=document.getElementById("debugger");t.hidden=!t.hidden},getDeviceData:function(){var t=new v.a,i=navigator.userAgent,e=t.parse(i);this.device=e.os.name},requiredFieldsCheck:function(){var t=this;this.$nextTick((function(){var i=document.querySelectorAll("div.activityGroup.required"),e=Array.from(i).map((function(t){return t.querySelectorAll("input:checked").length}));t.buttonClickable=-1==e.indexOf(0)}))},loadCounts:function(){var t=this;d.a.getItem("counts").then((function(i){return null!=i&&(t.counts=i,!0)})).then((function(i){i&&t.submitCounts()})).catch((function(t){console.error("There was an error "+t)}))},loadInitData:function(){var t=this;d.a.getItem("cachedinitdata").then((function(i){null!=i&&(t.cachedinitdata=y.omitBy(i,(function(t){return Date.now()-t.retrieved>36e5})))}))},loadInitInfo:function(){var t=this;d.a.getItem("initcache").then((function(i){null===i||Date.now()-i.retrieved>36e5?u.a.get(t.baseiniturl).then((function(i){i.data&&(t.initresults=i.data,d.a.setItem("initcache",{retrieved:Date.now(),initresults:i.data}))})).catch((function(t){console.error("There was an error "+t)})):t.initresults=i.initresults}))},updateInit:function(){var t=this;Object.keys(this.cachedinitdata).indexOf(this.currentinit)>-1?this.populateInitData(this.cachedinitdata[this.currentinit]):u.a.get("".concat(this.initurl).concat(this.currentinit)).then((function(i){t.populateInitData(i.data),t.$set(t.cachedinitdata,t.currentinit,y.set(i.data,"retrieved",Date.now()))}))},populateInitData:function(t){var i=this;this.initdata=t,this.children=[this.initdata.locations.children],this.cleanValues(-1,this.children[0],t);var e=this.initdata.activityGroups,n=y.groupBy(this.initdata.activities,"groupId");for(var a in this.activities={},n){var s=e.filter((function(t){return t.id==a}))[0];s["options"]=n[a],this.activities[a]=s}this.buttonClickable=-1==Object.keys(this.activities).map((function(t){return i.activities[t].required})).indexOf(!0)},updateChild:function(t){var i=this,e=this.children[t].filter((function(e){return e.id==i.childinit[t]}))[0].children;this.children=this.children.splice(0,t+1),e&&(this.children[t+1]=e),this.cleanValues(t,e)},cleanValues:function(t,i){var e=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var a in this.childinit)a>t&&(this.childinit[a]=void 0);i&&1==i.length&&(this.childinit[t+1]=i[0].id);var s=Object.keys(this.childinit).filter((function(t){return!y.isUndefined(e.childinit[t])})),o=y.max(s);this.location=this.childinit[o],this.createLocationTitle(n,s),this.showCounts(),this.resetActivityChecks()},createLocationTitle:function(t,i){var e=this,n=t||this.cachedinitdata[this.currentinit];this.locationtitle=n.initiativeTitle;for(var a=0;a<i.length;a++){var s=i[a],o=this.children[s].filter((function(t){return t.id==e.childinit[s]}))[0].title;this.locationtitle+=" | "+o}},showCounts:function(){this.showcounts=y.reject(Object.values(this.childinit),y.isUndefined).length==this.children.length},resetActivityChecks:function(){this.activityvalues={},this.activityvaluesmulti=[],document.body.scrollTop=0,document.documentElement.scrollTop=0,this.requiredFieldsCheck()},submitCounts:function(){var t=this,i=this.syncCountDict;if(""===i)return null;u()({method:"POST",url:this.syncurl,headers:{"content-type":"application/x-www-form-urlencoded"},data:"json=".concat(i)}).then((function(e){if("Transaction Complete"!=e.data)t.syncError();else{var n=JSON.parse(i),a=n.sessions.length,s=y.reduce(n.sessions,(function(t,i){return t["counts"]+=i.counts.length,t["locations"].push(i.counts.map((function(t){return t.location}))),t}),{counts:0,locations:[]}),o=y.uniq(y.flatten(s["locations"])).length,c=s["counts"];p()({title:"Counts submitted!",text:"".concat(c," ").concat(b()("counts",c),' (including "zero" counts) covering ').concat(o," ").concat(b()("locations",o)," in ").concat(a," ").concat(b()("initiatives",a)," has been sent to the server"),icon:"success"}),t.clearCounts()}})).catch((function(i){t.syncError(),console.log(i)}))},syncError:function(){p()("Sync error","Error sending data to server. This may be caused by issues including server outages and Wi-Fi             connectivity problems. The data will be retained by the browser. Please contact an administrator if             this doesn't resolve itself soon.","error")},clearCounts:function(){var t=this.initresults,i=this.cachedinitdata;Object.assign(this.$data,this.$options.data.call(this)),this.initresults=t,this.cachedinitdata=i},resetCounts:function(){var t=this;p()({title:"Abandon Session",text:"Are you sure you want to delete the data you've just collected? All data you've collected will be deleted permanently.",buttons:{delete:{text:"DELETE",value:"delete"},cancel:"Keep Collecting"}}).then((function(i){"delete"==i&&t.clearCounts()})).catch((function(t){console.log(t)}))},undoLastCount:function(){this.counts[this.currentinit]&&this.counts[this.currentinit]["counts"].length>0&&this.counts[this.currentinit]["counts"].pop(),this.resetActivityChecks()},getCounts:function(t){var i="";if(this.counts[this.currentinit]){var e=this.counts[this.currentinit]["counts"].filter((function(i){return i.location==t})),n=e.filter((function(t){return"0"!=t.number})).length;n>0?i=" (".concat(n,") "):e.filter((function(t){return"0"==t.number})).length>0&&(i=" (0) ")}return i},addToCount:function(t){var i=Math.round(Date.now()/1e3),e=this.activityvaluesmulti.concat(Object.values(this.activityvalues)),n=this.counts[this.currentinit]?this.counts[this.currentinit]:{counts:[],initiativeID:this.currentinit,startTime:i},a=this.location;y.remove(n["counts"],(function(t){return t.location==a&&"0"==t.number})),n["counts"].push({timestamp:i,location:this.location,activities:e,number:t}),n["endTime"]=i,this.$set(this.counts,this.currentinit,n),this.resetActivityChecks()},deselect:function(t,i){t==this.activityvalues[i]&&(this.activityvalues[i]=""),this.requiredFieldsCheck()}},computed:{syncCountDict:function(){var t=Object.values(this.counts),i=JSON.stringify({version:this.appVersion,device:this.device,sessions:t});return t.length>0?i:""}}},C=g,w=(e("85f9"),e("2877")),_=Object(w["a"])(C,o,c,!1,null,null,null),k=_.exports,T={name:"app",components:{SumaClient:k}},x=T,O=(e("034f"),Object(w["a"])(x,a,s,!1,null,null,null)),I=O.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(I)}}).$mount("#app")},"85ec":function(t,i,e){},"85f9":function(t,i,e){"use strict";var n=e("558e"),a=e.n(n);a.a}});
//# sourceMappingURL=app.ea3e240c.js.map